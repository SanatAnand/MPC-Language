% generated by Ott 0.25 from: grammar.ott
\documentclass[11pt]{article}
\usepackage{amsmath,amssymb}
\usepackage{supertabular}
\usepackage{geometry}
\usepackage{ifthen}
\usepackage{alltt}%hack
\geometry{a4paper,dvips,twoside,left=22.5mm,right=22.5mm,top=20mm,bottom=30mm}
\usepackage{color}
\newcommand{\ottdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\ottdrulename{#4}}}
\newcommand{\ottusedrule}[1]{\[#1\]}
\newcommand{\ottpremise}[1]{ #1 \\}
\newenvironment{ottdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{ottfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\ottfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\ottnt}[1]{\mathit{#1}}
\newcommand{\ottmv}[1]{\mathit{#1}}
\newcommand{\ottkw}[1]{\mathbf{#1}}
\newcommand{\ottsym}[1]{#1}
\newcommand{\ottcom}[1]{\text{#1}}
\newcommand{\ottdrulename}[1]{\textsc{#1}}
\newcommand{\ottcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\ottcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\ottcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\ottgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\ottmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\ottrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\ottprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\ottfirstprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\ottfirstlongprodline}[2]{\ottlongprodline{#1}{#2}}
\newcommand{\ottbindspecprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottprodnewline}{\\}
\newcommand{\ottinterrule}{\\[5.0mm]}
\newcommand{\ottafterlastrule}{\\}
\newcommand{\ottmetavars}{
\ottmetavartabular{
 $ \ottmv{n} ,\, \ottmv{m} ,\, \ottmv{k} ,\, \ottmv{i} ,\, \ottmv{j} $ & \ottcom{Index variables} \\
 $ \ottmv{A} ,\, \ottmv{B} $ & \ottcom{Names of parties A , B} \\
 $ \ottmv{P} ,\, \ottmv{Q} $ & \ottcom{Protocol name $\ottmv{P}$} \\
 $ \ottmv{x} ,\, \ottmv{y} ,\, \ottmv{s} $ & \ottcom{Variables Eg. Session, Party,  Integer variables.} \\
 $ \pi $ & \ottcom{Port types} \\
 $ \ottmv{env} $ & \ottcom{Special environment variable $\ottmv{env}$ denoting a port type} \\
 $ \ottmv{T} $ & \ottcom{Port names $\ottmv{T}$} \\
 $ \ottmv{O} $ & \ottcom{Code Object $\ottmv{O}$} \\
 $ \ottmv{G} $ & \ottcom{explained later} \\
 $ \ottmv{M} $ & \ottcom{explained later} \\
 $ \ottmv{R} $ & \ottcom{explained later} \\
 $ \ottmv{L} $ & \ottcom{explained later} \\
 $ \ottmv{S} $ & \ottcom{explained later} \\
}}

\newcommand{\otttau}{
\ottrulehead{\tau}{::=}{\ottcom{Types}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{Party}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Int}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Bool}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Session}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Port}}{}{}{}{\ottcom{subsumes inport and outport}}\ottprodnewline
\ottprodline{|}{\ottkw{Field}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Protocol}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{unknown}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{()}}{}{}{}{\ottcom{unit type}}\ottprodnewline
\ottprodline{|}{\ottsym{\_}}{}{}{}{\ottcom{don't care}}}

\newcommand{\ottconstant}{
\ottrulehead{\ottnt{constant}  ,\ \ottnt{c}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{integer\_literal}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{true}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{false}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{env}}{}{}{}{}}

\newcommand{\ottprogram}{
\ottrulehead{\ottnt{program}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{prtcl_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{prtcl_{\ottmv{n}}}}{}{}{}{\ottcom{one or more protocols}}}

\newcommand{\ottprtcl}{
\ottrulehead{\ottnt{prtcl}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottkw{protocol} \, \ottmv{P}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{(}  \ottnt{prtcl'}  \ottsym{)}  \ottsym{)}  \ottsym{:} \, \ottkw{party} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}} \, \ottkw{each} \, \ottkw{with} \, \ottsym{\{} \, \ottkw{Port} \, \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,} \, \ottkw{Port} \, \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}}{}{}{}{\ottcom{Protocol}}}

\newcommand{\ottstatement}{
\ottrulehead{\ottnt{statement}  ,\ \ottnt{stmt}}{::=}{\ottcom{Statements}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{stmt_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{\ottcom{Do something in the context of parties}}\ottprodnewline
\ottprodline{|}{\tau \, \ottmv{x}  \ottsym{;}}{}{}{}{\ottcom{Declare a variable}}\ottprodnewline
\ottprodline{|}{\ottnt{statement}  \ottsym{;}  \ottnt{statement'}  \ottsym{;}}{}{}{}{\ottcom{Sequence of statements}}\ottprodnewline
\ottprodline{|}{\ottmv{env}  \Rightarrow  \ottmv{x}  \ottsym{;}}{}{}{}{\ottcom{Send from environment to a variable}}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \Rightarrow  \ottmv{env}  \ottsym{;}}{}{}{}{\ottcom{Send from a variable to environment}}\ottprodnewline
\ottprodline{|}{\ottnt{exp}  \Rightarrow  \ottnt{exp'}}{}{}{}{\ottcom{Send from an expression to another expression}}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{;}}{}{}{}{\ottcom{Assign to a variable}}\ottprodnewline
\ottprodline{|}{\ottkw{open} \, \ottmv{s} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{:}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{:}  \ottmv{B_{\ottmv{m}}}  \ottsym{\}}}{}{}{}{\ottcom{Open a session called $\ottmv{s}$}}\ottprodnewline
\ottprodline{|}{\ottkw{set} \, \ottmv{A} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)::}  \ottmv{B}}{}{}{}{\ottcom{Set party $\ottmv{A}$ as another party $\ottmv{B}$ of another protocol $\ottmv{P}$}}\ottprodnewline
\ottprodline{|}{ \textbf{wrap} \ \{  \mathcal{W}_{stmt} ^+ \} }{}{}{}{\ottcom{Wrap some statements and perform some checks before or after doing something}}\ottprodnewline
\ottprodline{|}{ \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{and} \  \mathcal{P}_{exp}' }{}{}{}{\ottcom{Duplex connection between two ports}}\ottprodnewline
\ottprodline{|}{ \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{to} \  \mathcal{P}_{exp}' }{}{}{}{\ottcom{One way connection between two ports}}}

\newcommand{\ottwstmt}{
\ottrulehead{\mathcal{W}_{stmt}}{::=}{\ottcom{Statements inside wrap}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{before} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{after} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottpexp}{
\ottrulehead{\mathcal{P}_{exp}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottmv{A} \, \Vert \, \pi}{}{}{}{\ottcom{Port of a Party}}\ottprodnewline
\ottprodline{|}{\ottmv{A} \, \Vert \, \ottmv{B}}{}{}{}{\ottcom{Port of another Party}}\ottprodnewline
\ottprodline{|}{\ottmv{s}  \ottsym{.}  \ottmv{A} \, \Vert \, \pi}{}{}{}{\ottcom{Port $\pi$ of a Party $\ottmv{A}$ that belongs to session $\ottmv{s}$}}}

\newcommand{\ottexp}{
\ottrulehead{\ottnt{exp}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{exp}  \ottsym{+}  \ottnt{exp'}}{}{}{}{\ottcom{Addition of two expresions}}\ottprodnewline
\ottprodline{|}{\ottmv{A}  \ottsym{.}  \ottmv{x}}{}{}{}{\ottcom{Variable $\ottmv{x}$ of a party $\ottmv{A}$}}\ottprodnewline
\ottprodline{|}{\ottmv{x}}{}{}{}{\ottcom{Expression statement}}}

\newcommand{\ottscope}{
\ottrulehead{\ottnt{scope}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \mathcal{C} }{}{}{}{\ottcom{Current Scope}}\ottprodnewline
\ottprodline{|}{\ottsym{\_}}{}{}{}{\ottcom{Do not care}}\ottprodnewline
\ottprodline{|}{ \mathcal{G} }{}{}{}{\ottcom{Global Scope}}\ottprodnewline
\ottprodline{|}{\ottmv{A}}{}{}{}{\ottcom{Party Scope for statements like in A \{ .. \}}}}

\newcommand{\ottTenv}{
\ottrulehead{\mathcal{E}}{::=}{\ottcom{Type environment}}\ottprodnewline
\ottfirstprodline{|}{ \phi }{}{}{}{\ottcom{Empty Type enviornment}}\ottprodnewline
\ottprodline{|}{\ottmv{G}}{}{}{}{\ottcom{A function that takes a variable name and returns its type and scope}}\ottprodnewline
\ottprodline{|}{\ottmv{M}}{}{}{}{\ottcom{A function that takes a protocol name and returns a tuple ( argsig , Party list )}}\ottprodnewline
\ottprodline{|}{\ottmv{R}}{}{}{}{\ottcom{A function that takes a tuple (Protocol name , Party name) and returns list of Ports the party has}}\ottprodnewline
\ottprodline{|}{\ottmv{S}}{}{}{}{\ottcom{Maps a session name to the name of a protocol}}\ottprodnewline
\ottprodline{|}{\ottmv{L}}{}{}{}{\ottcom{Maps ( Party name , Scope ) to the list of ports}}\ottprodnewline
\ottprodline{|}{\ottnt{scope}}{}{}{}{\ottcom{The current scope of execution}}\ottprodnewline
\ottprodline{|}{\mathcal{E}  \ottsym{,}  \mathcal{E}'}{}{}{}{\ottcom{A sequence of Type environments}}}

\newcommand{\ottCenv}{
\ottrulehead{\mathcal{M}}{::=}{\ottcom{Compilation environment}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{empty}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{E}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{O}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{P}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{K}}{}{}{}{}}

\newcommand{\ottargsig}{
\ottrulehead{\ottnt{argsig}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{\{}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottportlist}{
\ottrulehead{\ottnt{portlist}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{\{}  \ottmv{T_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{T_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottgrammar}{\ottgrammartabular{
\otttau\ottinterrule
\ottconstant\ottinterrule
\ottprogram\ottinterrule
\ottprtcl\ottinterrule
\ottstatement\ottinterrule
\ottwstmt\ottinterrule
\ottpexp\ottinterrule
\ottexp\ottinterrule
\ottscope\ottinterrule
\ottTenv\ottinterrule
\ottCenv\ottinterrule
\ottargsig\ottinterrule
\ottportlist\ottafterlastrule
}}

% defnss
% defns Jtype
%% defn Constant
\newcommand{\ottdruleConstantXXInt}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottsym{integer\_literal}  \ottsym{:}  \ottkw{Int}}{%
{\ottdrulename{Constant\_Int}}{}%
}}


\newcommand{\ottdruleConstantXXtrue}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{true}  \ottsym{:}  \ottkw{Bool}}{%
{\ottdrulename{Constant\_true}}{}%
}}


\newcommand{\ottdruleConstantXXfalse}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{false}  \ottsym{:}  \ottkw{Bool}}{%
{\ottdrulename{Constant\_false}}{}%
}}

\newcommand{\ottdefnConstant}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{constant}  \ottsym{:}  \tau$}{\ottcom{Checking constants}}
\ottusedrule{\ottdruleConstantXXInt{}}
\ottusedrule{\ottdruleConstantXXtrue{}}
\ottusedrule{\ottdruleConstantXXfalse{}}
\end{ottdefnblock}}

%% defn Stmt
\newcommand{\ottdruleStmtXXdecl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \neq  \ottsym{(}  \ottsym{\_}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G'}  \ottsym{=}  \ottmv{G}  \ottsym{[}  \ottmv{x}  \longrightarrow  \ottsym{(}  \tau  \ottsym{,}   \mathcal{C}   \ottsym{)}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \tau \, \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_decl}}{}%
}}


\newcommand{\ottdruleStmtXXseq}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement}  \ottsym{;}  \ottnt{statement'}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}  \ottsym{\_}}{%
{\ottdrulename{Stmt\_seq}}{}%
}}


\newcommand{\ottdruleStmtXXpvt}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A_{\ottmv{m}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''''}  \ottsym{,}  \ottmv{L''''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{stmt_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''''}  \ottsym{,}  \ottmv{L''''}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_pvt}}{}%
}}


\newcommand{\ottdruleStmtXXsendEnvToVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{env}  \Rightarrow  \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendEnvToVar}}{}%
}}


\newcommand{\ottdruleStmtXXsendVarToEnv}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{x}  \Rightarrow  \ottmv{env}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendVarToEnv}}{}%
}}


\newcommand{\ottdruleStmtXXsendExprToExpr}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp'}  \ottsym{:}  \tau'}%
\ottpremise{\tau \, \in \, \ottsym{\{}  \ottkw{Port}  \ottsym{,}  \ottkw{Int}  \ottsym{,}  \ottkw{Bool}  \ottsym{,}  \ottkw{unknown}  \ottsym{\}}}%
\ottpremise{\tau' \, \in \, \ottsym{\{}  \ottkw{Port}  \ottsym{,}  \ottkw{Int}  \ottsym{,}  \ottkw{Bool}  \ottsym{,}  \ottkw{unknown}  \ottsym{\}}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \Rightarrow  \ottnt{exp'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendExprToExpr}}{}%
}}


\newcommand{\ottdruleStmtXXassignmnt}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_assignmnt}}{}%
}}


\newcommand{\ottdruleStmtXXopenSession}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Session}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{P} \, \in \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{\ottmv{n}}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottsym{[}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{]}  \ottsym{==}  \ottnt{argsig}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{B_{\ottmv{m}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{S'}  \ottsym{=}  \ottmv{S}  \ottsym{[}  \ottmv{s}  \longrightarrow  \ottmv{P}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{open} \, \ottmv{s} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{:}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{:}  \ottmv{B_{\ottmv{m}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_openSession}}{}%
}}


\newcommand{\ottdruleStmtXXset}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{P} \, \in \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{\ottmv{n}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{B} \, \in \, \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}}%
\ottpremise{\ottsym{[}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{]}  \ottsym{==}  \ottnt{argsig}}%
\ottpremise{\ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{B}  \ottsym{)} \, \in \, \ottkw{dom} \, \ottmv{R}}%
\ottpremise{\ottmv{R}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{B}  \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{L'}  \ottsym{=}  \ottmv{L}  \ottsym{[}  \ottsym{(}  \ottmv{A}  \ottsym{,}   \mathcal{C}   \ottsym{)}  \longrightarrow  \ottnt{portlist}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{set} \, \ottmv{A} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)::}  \ottmv{B}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_set}}{}%
}}


\newcommand{\ottdruleStmtXXwrap}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{wrap} \ \{  \mathcal{W}_{stmt} ^+ \}   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_wrap}}{}%
}}


\newcommand{\ottdruleStmtXXconnectTo}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottkw{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}'  \ottsym{:}  \ottkw{Port}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{to} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_connectTo}}{}%
}}


\newcommand{\ottdruleStmtXXconnectAnd}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottkw{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}'  \ottsym{:}  \ottkw{Port}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{and} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_connectAnd}}{}%
}}

\newcommand{\ottdefnStmt}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{stmt}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdruleStmtXXdecl{}}
\ottusedrule{\ottdruleStmtXXseq{}}
\ottusedrule{\ottdruleStmtXXpvt{}}
\ottusedrule{\ottdruleStmtXXsendEnvToVar{}}
\ottusedrule{\ottdruleStmtXXsendVarToEnv{}}
\ottusedrule{\ottdruleStmtXXsendExprToExpr{}}
\ottusedrule{\ottdruleStmtXXassignmnt{}}
\ottusedrule{\ottdruleStmtXXopenSession{}}
\ottusedrule{\ottdruleStmtXXset{}}
\ottusedrule{\ottdruleStmtXXwrap{}}
\ottusedrule{\ottdruleStmtXXconnectTo{}}
\ottusedrule{\ottdruleStmtXXconnectAnd{}}
\end{ottdefnblock}}

%% defn Wrapstmt
\newcommand{\ottdruleWrapstmtXXbefore}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottkw{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{before} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}{%
{\ottdrulename{Wrapstmt\_before}}{}%
}}


\newcommand{\ottdruleWrapstmtXXafter}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottkw{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{after} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}{%
{\ottdrulename{Wrapstmt\_after}}{}%
}}

\newcommand{\ottdefnWrapstmt}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdruleWrapstmtXXbefore{}}
\ottusedrule{\ottdruleWrapstmtXXafter{}}
\end{ottdefnblock}}

%% defn Protocol
\newcommand{\ottdrulePrtclXXdecl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{P} \, \notin \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{G'}  \ottsym{=}  \ottmv{G}  \ottsym{[}  \ottmv{P}  \longrightarrow  \ottsym{(}  \ottkw{Protocol}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G''}  \ottsym{=}  \ottmv{G'}  \ottsym{[}  \ottmv{x_{{\mathrm{1}}}}  \longrightarrow  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G'''}  \ottsym{=}  \ottmv{G''}  \ottsym{[}  \ottmv{A}  \longrightarrow  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottnt{portlist}  \ottsym{=}  \ottsym{\{}  \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}}%
\ottpremise{\ottmv{R'}  \ottsym{=}  \ottmv{R}  \ottsym{[}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{)}  \longrightarrow  \ottnt{portlist}  \ottsym{]}}%
\ottpremise{\ottmv{M'}  \ottsym{=}  \ottmv{M}  \ottsym{[}  \ottmv{P}  \longrightarrow  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M'}  \ottsym{,}  \ottmv{R'}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \vdash  \ottnt{prtcl'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R'''}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}}%
}{
\ottmv{M}  \ottsym{,}  \ottmv{R}  \vdash  \ottkw{protocol} \, \ottmv{P}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{(}  \ottnt{prtcl'}  \ottsym{)}  \ottsym{)}  \ottsym{:} \, \ottkw{party} \, \ottmv{A} \, \ottkw{each} \, \ottkw{with} \, \ottsym{\{} \, \ottkw{Port} \, \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,} \, \ottkw{Port} \, \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}}{%
{\ottdrulename{Prtcl\_decl}}{}%
}}

\newcommand{\ottdefnProtocol}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{prtcl}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdrulePrtclXXdecl{}}
\end{ottdefnblock}}

%% defn Exp
\newcommand{\ottdruleExpXXAddition}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp'}  \ottsym{:}  \tau}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{+}  \ottnt{exp'}  \ottsym{:}  \tau}{%
{\ottdrulename{Exp\_Addition}}{}%
}}


\newcommand{\ottdruleExpXXPartyVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}  \ottmv{A}  \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{A}  \ottsym{.}  \ottmv{x}  \ottsym{:}  \ottkw{Int}}{%
{\ottdrulename{Exp\_PartyVar}}{}%
}}


\newcommand{\ottdruleExpXXStatement}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \vdash  \ottmv{x}  \ottsym{:}  \tau}{%
{\ottdrulename{Exp\_Statement}}{}%
}}

\newcommand{\ottdefnExp}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{exp}  \ottsym{:}  \tau$}{}
\ottusedrule{\ottdruleExpXXAddition{}}
\ottusedrule{\ottdruleExpXXPartyVar{}}
\ottusedrule{\ottdruleExpXXStatement{}}
\end{ottdefnblock}}

%% defn Pexp
\newcommand{\ottdrulePexpXXExpToEnv}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Session}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{S}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottmv{P}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{A} \, \in \, \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}}%
\ottpremise{\ottmv{R}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\pi \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{s}  \ottsym{.}  \ottmv{A} \, \Vert \, \pi  \ottsym{:}  \ottkw{Port}}{%
{\ottdrulename{Pexp\_ExpToEnv}}{}%
}}


\newcommand{\ottdrulePexpXXPortOfParty}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{L}  \ottsym{(}  \ottmv{A}  \ottsym{,}   \mathcal{C}   \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\pi \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{A} \, \Vert \, \pi  \ottsym{:}  \ottkw{Port}}{%
{\ottdrulename{Pexp\_PortOfParty}}{}%
}}


\newcommand{\ottdrulePexpXXPortOfAnotherParty}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{L}  \ottsym{(}  \ottmv{A}  \ottsym{,}   \mathcal{C}   \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{B} \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{A} \, \Vert \, \ottmv{B}  \ottsym{:}  \ottkw{Port}}{%
{\ottdrulename{Pexp\_PortOfAnotherParty}}{}%
}}

\newcommand{\ottdefnPexp}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \mathcal{P}_{exp}  \ottsym{:}  \tau$}{}
\ottusedrule{\ottdrulePexpXXExpToEnv{}}
\ottusedrule{\ottdrulePexpXXPortOfParty{}}
\ottusedrule{\ottdrulePexpXXPortOfAnotherParty{}}

\section{Compilation Semantics}
\label{sec.comp}
The following rules define the compilation sematics of our language \\
\end{ottdefnblock}}


\newcommand{\ottdefnsJtype}{
\ottdefnConstant{}\ottdefnStmt{}\ottdefnWrapstmt{}\ottdefnProtocol{}\ottdefnExp{}\ottdefnPexp{}}

% defns Jop
%% defn stmt_com
\newcommand{\ottdrulestmtXXcominStmt}[1]{\ottdrule[#1]{%
\ottpremise{\ottkw{E}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{,}  \ottmv{B}  \ottsym{)}  \ottsym{=}  \ottmv{O_{{\mathrm{1}}}}}%
}{
\ottkw{E}  \vdash  \ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}  \ottsym{:}  \ottkw{E}}{%
{\ottdrulename{stmt\_cominStmt}}{}%
}}

\newcommand{\ottdefnstmtXXcom}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \ottnt{stmt}  \ottsym{:}  \mathcal{M}'$}{\ottcom{Statements}}
\ottusedrule{\ottdrulestmtXXcominStmt{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsJop}{
\ottdefnstmtXXcom{}}

\newcommand{\ottdefnss}{
\ottdefnsJtype
\ottdefnsJop
}

\newcommand{\ottall}{\ottmetavars\\[0pt]
\ottgrammar\\[5.0mm]
\ottdefnss}

\begin{document}
\ottall

\begin{verbatim}
Definition rules:        25 good    0 bad
Definition rule clauses: 101 good    0 bad
\end{verbatim}
\end{document}
