% generated by Ott 0.25 from: ../ott-definitions/grammar.ott
\newcommand{\ottdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\ottdrulename{#4}}}
\newcommand{\ottusedrule}[1]{\[#1\]}
\newcommand{\ottpremise}[1]{ #1 \\}
\newenvironment{ottdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{ottfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\ottfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\ottnt}[1]{\mathit{#1}}
\newcommand{\ottmv}[1]{\mathit{#1}}
\newcommand{\ottkw}[1]{\mathbf{#1}}
\newcommand{\ottsym}[1]{#1}
\newcommand{\ottcom}[1]{\text{#1}}
\newcommand{\ottdrulename}[1]{\textsc{#1}}
\newcommand{\ottcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\ottcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\ottcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\ottgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\ottmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\ottrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\ottprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\ottfirstprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\ottfirstlongprodline}[2]{\ottlongprodline{#1}{#2}}
\newcommand{\ottbindspecprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottprodnewline}{\\}
\newcommand{\ottinterrule}{\\[5.0mm]}
\newcommand{\ottafterlastrule}{\\}
\newcommand{\ottmetavars}{
\ottmetavartabular{
 $ \ottmv{n} ,\, \ottmv{m} ,\, \ottmv{k} ,\, \ottmv{i} ,\, \ottmv{j} ,\, \ottmv{o} ,\, \ottmv{e} ,\, \ottmv{c} $ & \ottcom{Index variables} \\
 $ \ottmv{A} ,\, \ottmv{B} ,\, \ottmv{D} ,\, \ottmv{Z} $ & \ottcom{Names of parties A , B} \\
 $ \ottmv{P} ,\, \ottmv{Q} $ & \ottcom{Protocol name $\ottmv{P}$} \\
 $ \ottmv{x} ,\, \ottmv{y} ,\, \ottmv{s} $ & \ottcom{Variables Eg. Session, Party,  Integer variables.} \\
 $ \ottmv{r} $ & \ottcom{Port types} \\
 $ \ottmv{w} $ & \ottcom{Wire variable} \\
 $ \ottmv{env} $ & \ottcom{Special environment variable $\ottmv{env}$ denoting a port type} \\
 $ \ottmv{T} $ & \ottcom{Port names $\ottmv{T}$} \\
 $ \ottmv{O} $ & \ottcom{Code Object $\ottmv{O}$} \\
 $ \ottmv{G} $ & \ottcom{Part of type environment} \\
 $ \ottmv{M} $ & \ottcom{Part of type environment} \\
 $ \ottmv{R} $ & \ottcom{Part of type environment} \\
 $ \ottmv{L} $ & \ottcom{Part of type environment} \\
 $ \ottmv{S} $ & \ottcom{Part of type environment} \\
 $ \ottmv{E} $ & \ottcom{Part of compilation environment} \\
 $ \ottmv{K} $ & \ottcom{Part of compilation environment} \\
}}

\newcommand{\otttau}{
\ottrulehead{\tau}{::=}{\ottcom{Types}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{Party}}{}{}{}{\ottcom{The parties are denoted by the metavariables A, B, D, Z}}\ottprodnewline
\ottprodline{|}{\ottkw{Int}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Bool}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{Session}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{Port}}{}{}{}{\ottcom{Subsumes inport and outport}}\ottprodnewline
\ottprodline{|}{\ottkw{Field}}{}{}{}{\ottcom{Currently considered as an integer type}}\ottprodnewline
\ottprodline{|}{\ottkw{Protocol}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{unknown}}{}{}{}{\ottcom{For types that are not known currently}}\ottprodnewline
\ottprodline{|}{\ottsym{()}}{}{}{}{\ottcom{unit type}}\ottprodnewline
\ottprodline{|}{\ottsym{\_}}{}{}{}{\ottcom{don't care}}}

\newcommand{\ottPort}{
\ottrulehead{\ottnt{Port}}{::=}{\ottcom{Types of Port}}\ottprodnewline
\ottfirstprodline{|}{ \textcircled{$\downarrow$} }{}{}{}{\ottcom{inport}}\ottprodnewline
\ottprodline{|}{ \textcircled{$\uparrow$} }{}{}{}{\ottcom{outport}}}

\newcommand{\ottconstant}{
\ottrulehead{\ottnt{constant}}{::=}{\ottcom{Types of constant}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{integer\_literal}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{true}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{false}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{env}}{}{}{}{}}

\newcommand{\ottprogram}{
\ottrulehead{\ottnt{program}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{prtcl_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{prtcl_{\ottmv{n}}}}{}{}{}{\ottcom{A program consists of one or more protocols}}}

\newcommand{\ottprtcl}{
\ottrulehead{\ottnt{prtcl}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottkw{protocol} \, \ottmv{P}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{(}  \ottnt{prtcl'}  \ottsym{)}  \ottsym{)}  \ottsym{:} \, \ottkw{party} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}} \, \ottkw{each} \, \ottkw{with} \, \ottsym{\{}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{i}}} \, \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottstatement}{
\ottrulehead{\ottnt{statement}  ,\ \ottnt{stmt}}{::=}{\ottcom{Statements}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{stmt_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{\ottcom{Do something in the context of parties}}\ottprodnewline
\ottprodline{|}{\tau \, \ottmv{x}  \ottsym{;}}{}{}{}{\ottcom{Declare a variable}}\ottprodnewline
\ottprodline{|}{\ottnt{statement}  \ottsym{;}  \ottnt{statement'}  \ottsym{;}}{}{}{}{\ottcom{Sequence of statements}}\ottprodnewline
\ottprodline{|}{\mathcal{P}_{exp}  \Rightarrow  \ottmv{x}  \ottsym{;}}{}{}{}{\ottcom{Send from environment to a variable}}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \Rightarrow  \mathcal{P}_{exp}  \ottsym{;}}{}{}{}{\ottcom{Send from a variable to environment}}\ottprodnewline
\ottprodline{|}{\ottnt{exp}  \Rightarrow  \ottnt{exp'}}{}{}{}{\ottcom{Send from an expression to another expression}}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{;}}{}{}{}{\ottcom{Assign to a variable}}\ottprodnewline
\ottprodline{|}{\mathcal{P}_{exp}  \Rightarrow  \mathcal{P}_{exp}'  \ottsym{;}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{open} \, \ottmv{s} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{:}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{:}  \ottmv{B_{\ottmv{m}}}  \ottsym{\}}}{}{}{}{\ottcom{Open a session called $\ottmv{s}$}}\ottprodnewline
\ottprodline{|}{\ottkw{set} \, \ottmv{A} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)::}  \ottmv{B}}{}{}{}{\ottcom{Set party $\ottmv{A}$ as another party $\ottmv{B}$ of another protocol $\ottmv{P}$}}\ottprodnewline
\ottprodline{|}{ \textbf{wrap} \ \{  \mathcal{W}_{stmt} ^+ \} }{}{}{}{\ottcom{Wrap some statements and perform some checks before or after doing something}}\ottprodnewline
\ottprodline{|}{ \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{and} \  \mathcal{P}_{exp}' }{}{}{}{\ottcom{Duplex connection between two ports}}\ottprodnewline
\ottprodline{|}{ \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{to} \  \mathcal{P}_{exp}' }{}{}{}{\ottcom{One way connection between two ports}}}

\newcommand{\ottwstmt}{
\ottrulehead{\mathcal{W}_{stmt}}{::=}{\ottcom{Statements inside wrap}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{before} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{after} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{}}

\newcommand{\ottpexp}{
\ottrulehead{\mathcal{P}_{exp}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottmv{A} \, \Vert \, \ottnt{portname}}{}{}{}{\ottcom{Port of a Party. The name of the ports can be Party name, env etc.}}\ottprodnewline
\ottprodline{|}{\ottmv{s}  \ottsym{.}  \ottmv{A} \, \Vert \, \ottnt{portname}}{}{}{}{\ottcom{Port $\ottnt{portname}$ of a Party $\ottmv{A}$ that belongs to session $\ottmv{s}$}}\ottprodnewline
\ottprodline{|}{\ottmv{r}}{}{}{}{\ottcom{Just the name of a port}}}

\newcommand{\ottexp}{
\ottrulehead{\ottnt{exp}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottnt{exp}  \ottsym{+}  \ottnt{exp'}}{}{}{}{\ottcom{Addition of two expresions}}\ottprodnewline
\ottprodline{|}{\ottmv{A}  \ottsym{.}  \ottmv{x}}{}{}{}{\ottcom{Variable $\ottmv{x}$ of a party $\ottmv{A}$}}\ottprodnewline
\ottprodline{|}{\ottmv{x}}{}{}{}{\ottcom{Expression statement}}}

\newcommand{\ottscope}{
\ottrulehead{\ottnt{scope}}{::=}{\ottcom{The Various types of scopes}}\ottprodnewline
\ottfirstprodline{|}{\ottsym{\_}}{}{}{}{\ottcom{Do not care about the scope}}\ottprodnewline
\ottprodline{|}{ \mathcal{C} }{}{}{}{\ottcom{Current Scope}}\ottprodnewline
\ottprodline{|}{ \mathcal{G} }{}{}{}{\ottcom{Global Scope}}\ottprodnewline
\ottprodline{|}{\ottmv{A}}{}{}{}{\ottcom{Party Scope for statements like in A \{ .. \}}}\ottprodnewline
\ottprodline{|}{\ottmv{P}}{}{}{}{\ottcom{Protocol Scope}}\ottprodnewline
\ottprodline{|}{\ottmv{s}}{}{}{}{\ottcom{Sessions Scope}}\ottprodnewline
\ottprodline{|}{\ottnt{scope}  \ottsym{.}  \ottnt{scope'}}{}{}{}{\ottcom{$\ottnt{scope}$ within another $\ottnt{scope'}$}}}

\newcommand{\ottargsig}{
\ottrulehead{\ottnt{argsig}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{\{}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{\}}}{}{}{}{\ottcom{Arguments signature consists of only the list of types taken as argument by a protocol}}}

\newcommand{\ottportlist}{
\ottrulehead{\ottnt{portlist}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\ottsym{\{}  \ottmv{T_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{T_{\ottmv{n}}}  \ottsym{\}}}{}{}{}{\ottcom{List of ports a protocol has}}}

\newcommand{\ottTenv}{
\ottrulehead{\mathcal{E}}{::=}{\ottcom{Type environment for evaluating stmt and expr}}\ottprodnewline
\ottfirstprodline{|}{ \phi }{}{}{}{\ottcom{Empty Type enviornment}}\ottprodnewline
\ottprodline{|}{\ottmv{G}}{}{}{}{\ottcom{A function that takes a variable name and returns its type and scope}}\ottprodnewline
\ottprodline{|}{\ottmv{M}}{}{}{}{\ottcom{A function that takes a protocol name and returns a tuple ( argsig , Party list )}}\ottprodnewline
\ottprodline{|}{\ottmv{R}}{}{}{}{\ottcom{Mapping of (Protocol name , Party name) to the list of Ports the party has}}\ottprodnewline
\ottprodline{|}{\ottmv{S}}{}{}{}{\ottcom{Maps a session name to the name of a protocol}}\ottprodnewline
\ottprodline{|}{\ottmv{L}}{}{}{}{\ottcom{Maps ( Party name , Scope ) to the list of ports}}\ottprodnewline
\ottprodline{|}{\ottnt{scope}}{}{}{}{\ottcom{The current scope of execution can also be a type environment}}\ottprodnewline
\ottprodline{|}{\mathcal{E}  \ottsym{,}  \mathcal{E}'}{}{}{}{\ottcom{Sequence of Type environments}}}

\newcommand{\ottCenv}{
\ottrulehead{\mathcal{M}}{::=}{\ottcom{Compilation environment for evaluating stmt and expr}}\ottprodnewline
\ottfirstprodline{|}{ \phi }{}{}{}{\ottcom{Empty compilation environment}}\ottprodnewline
\ottprodline{|}{\ottmv{E}}{}{}{}{\ottcom{Maps ( Protocol, Party, PartyScope ) to Code Object}}\ottprodnewline
\ottprodline{|}{\ottmv{O}  \langle  \ottnt{scope}  \rangle}{}{}{}{\ottcom{Represents code object}}\ottprodnewline
\ottprodline{|}{\ottmv{O}}{}{}{}{\ottcom{Represents a code object}}\ottprodnewline
\ottprodline{|}{\ottmv{P}}{}{}{}{\ottcom{Represents protcol}}\ottprodnewline
\ottprodline{|}{\ottmv{K}}{}{}{}{\ottcom{Maps code objects to list of ports}}\ottprodnewline
\ottprodline{|}{\mathcal{M}  \ottsym{,}  \mathcal{M}'}{}{}{}{\ottcom{Sequence of Compilation Environments}}\ottprodnewline
\ottprodline{|}{\ottkw{val}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{A}}{}{}{}{}}

\newcommand{\ottportname}{
\ottrulehead{\ottnt{portname}}{::=}{\ottcom{Name of a port}}\ottprodnewline
\ottfirstprodline{|}{\ottmv{r}}{}{}{}{\ottcom{generic name of a port}}\ottprodnewline
\ottprodline{|}{ \varepsilon }{}{}{}{\ottcom{environment port}}\ottprodnewline
\ottprodline{|}{\ottmv{A}}{}{}{}{\ottcom{Party can also be the name of a port for some other party}}\ottprodnewline
\ottprodline{|}{\ottmv{x}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottnt{scope}  \ottsym{.}  \ottnt{portname}}{}{}{}{}}

\newcommand{\ottcompXXinstr}{
\ottrulehead{\ottnt{comp\_instr}}{::=}{\ottcom{Compilation Instructions}}\ottprodnewline
\ottfirstprodline{|}{\underrightarrow{create}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\underrightarrow{append}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\underrightarrow{attach}}{}{}{}{\ottcom{Attach a wire to a code object}}\ottprodnewline
\ottprodline{|}{\xLongrightarrow{copycode}}{}{}{}{\ottcom{Copy code from a code object to another}}\ottprodnewline
\ottprodline{|}{\underrightarrow{replace}}{}{}{}{\ottcom{Replace a temporary string with code}}\ottprodnewline
\ottprodline{|}{\ottnt{impl\_instr}}{}{}{}{}}

\newcommand{\ottcompXXtypes}{
\ottrulehead{\ottnt{comp\_types}}{::=}{\ottcom{Types needed for compilation}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{Port}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \rightfilledspoon }{}{}{}{\ottcom{wire}}}

\newcommand{\ottprtXXcnc}{
\ottrulehead{\ottnt{prt\_cnc}}{::=}{\ottcom{Specifies how the wire connections are going to be made}}\ottprodnewline
\ottfirstprodline{|}{\rightleftharpoons}{}{}{}{\ottcom{Bi-directional}}\ottprodnewline
\ottprodline{|}{\rightharpoonccw}{}{}{}{\ottcom{Uni-directional out}}\ottprodnewline
\ottprodline{|}{\leftharpoonccw}{}{}{}{\ottcom{Uni-directional in}}}

\newcommand{\ottimplXXinstr}{
\ottrulehead{\ottnt{impl\_instr}}{::=}{\ottcom{Instructions from the implementation language}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{while} \, \ottsym{(}  \ottnt{impl\_expr}  \ottsym{)}  \ottsym{\{}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{\}}}{}{}{}{\ottcom{While statement}}\ottprodnewline
\ottprodline{|}{\ottkw{if} \, \ottsym{(}  \ottnt{impl\_expr}  \ottsym{)}  \ottsym{\{}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{\}}}{}{}{}{\ottcom{If Statement}}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottnt{portname}  \ottsym{)}}{}{}{}{\ottcom{Read from a port}}\ottprodnewline
\ottprodline{|}{\ottnt{portname}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottmv{x}  \ottsym{)}}{}{}{}{\ottcom{Read from a variable}}\ottprodnewline
\ottprodline{|}{\ottnt{portname}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottnt{portname'}  \ottsym{)}}{}{}{}{\ottcom{Read from a port}}\ottprodnewline
\ottprodline{|}{\ottkw{send} \, \ottmv{x} \, \ottkw{to} \, \ottmv{A}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottmv{x}  \ottsym{=}  \ottnt{exp}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{read} \, \ottsym{(}  \ottnt{exp}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{read} \, \ottsym{(}  \ottnt{exp}  \ottsym{)}  \ottsym{+} \, \ottkw{read} \, \ottsym{(}  \ottnt{exp'}  \ottsym{)}}{}{}{}{\ottcom{Read the value of a variable}}\ottprodnewline
\ottprodline{|}{\tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{;}}{}{}{}{\ottcom{Create new variable}}}

\newcommand{\ottimplXXexpr}{
\ottrulehead{\ottnt{impl\_expr}}{::=}{\ottcom{Expressions for the implementation language}}\ottprodnewline
\ottfirstprodline{|}{\ottnt{constant}}{}{}{}{\ottcom{Booleans like true or false}}\ottprodnewline
\ottprodline{|}{\ottnt{portname}}{}{}{}{\ottcom{Portname}}\ottprodnewline
\ottprodline{|}{\ottnt{portname}  \ottsym{.} \, \ottkw{ITR}}{}{}{}{\ottcom{Port intent to read}}}

\newcommand{\ottgrammar}{\ottgrammartabular{
\otttau\ottinterrule
\ottPort\ottinterrule
\ottconstant\ottinterrule
\ottprogram\ottinterrule
\ottprtcl\ottinterrule
\ottstatement\ottinterrule
\ottwstmt\ottinterrule
\ottpexp\ottinterrule
\ottexp\ottinterrule
\ottscope\ottinterrule
\ottargsig\ottinterrule
\ottportlist\ottinterrule
\ottTenv\ottinterrule
\ottCenv\ottinterrule
\ottportname\ottinterrule
\ottcompXXinstr\ottinterrule
\ottcompXXtypes\ottinterrule
\ottprtXXcnc\ottinterrule
\ottimplXXinstr\ottinterrule
\ottimplXXexpr\ottafterlastrule
}}

% defnss
% defns Jtype
%% defn Constant
\newcommand{\ottdruleConstantXXInt}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottsym{integer\_literal}  \ottsym{:}  \ottkw{Int}}{%
{\ottdrulename{Constant\_Int}}{}%
}}


\newcommand{\ottdruleConstantXXtrue}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{true}  \ottsym{:}  \ottkw{Bool}}{%
{\ottdrulename{Constant\_true}}{}%
}}


\newcommand{\ottdruleConstantXXfalse}[1]{\ottdrule[#1]{%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{false}  \ottsym{:}  \ottkw{Bool}}{%
{\ottdrulename{Constant\_false}}{}%
}}

\newcommand{\ottdefnConstant}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{constant}  \ottsym{:}  \tau$}{\ottcom{Checking constants}}
\ottusedrule{\ottdruleConstantXXInt{}}
\ottusedrule{\ottdruleConstantXXtrue{}}
\ottusedrule{\ottdruleConstantXXfalse{}}
\end{ottdefnblock}}

%% defn Stmt
\newcommand{\ottdruleStmtXXdecl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \neq  \ottsym{(}  \ottsym{\_}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G'}  \ottsym{=}  \ottmv{G}  \ottsym{[}  \ottmv{x}  \longrightarrow  \ottsym{(}  \tau  \ottsym{,}   \mathcal{C}   \ottsym{)}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \tau \, \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_decl}}{}%
}}


\newcommand{\ottdruleStmtXXseq}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottsym{\_}  \vdash  \ottnt{statement}  \ottsym{;}  \ottnt{statement'}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}  \ottsym{\_}}{%
{\ottdrulename{Stmt\_seq}}{}%
}}


\newcommand{\ottdruleStmtXXpvt}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A_{\ottmv{m}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''''}  \ottsym{,}  \ottmv{L''''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{stmt_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''''}  \ottsym{,}  \ottmv{L''''}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_pvt}}{}%
}}


\newcommand{\ottdruleStmtXXsendPortToVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \Rightarrow  \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendPortToVar}}{}%
}}


\newcommand{\ottdruleStmtXXsendVarToPort}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{x}  \Rightarrow  \mathcal{P}_{exp}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendVarToPort}}{}%
}}


\newcommand{\ottdruleStmtXXsendExprToExpr}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp'}  \ottsym{:}  \tau'}%
\ottpremise{\tau \, \in \, \ottsym{\{}  \ottnt{Port}  \ottsym{,}  \ottkw{Int}  \ottsym{,}  \ottkw{Bool}  \ottsym{,}  \ottkw{unknown}  \ottsym{\}}}%
\ottpremise{\tau' \, \in \, \ottsym{\{}  \ottnt{Port}  \ottsym{,}  \ottkw{Int}  \ottsym{,}  \ottkw{Bool}  \ottsym{,}  \ottkw{unknown}  \ottsym{\}}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \Rightarrow  \ottnt{exp'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_sendExprToExpr}}{}%
}}


\newcommand{\ottdruleStmtXXassignmnt}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{;}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_assignmnt}}{}%
}}


\newcommand{\ottdruleStmtXXopenSession}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Session}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{P} \, \in \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{\ottmv{n}}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottsym{[}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{]}  \ottsym{==}  \ottnt{argsig}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{B_{\ottmv{m}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{S'}  \ottsym{=}  \ottmv{S}  \ottsym{[}  \ottmv{s}  \longrightarrow  \ottmv{P}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{open} \, \ottmv{s} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{:}  \ottmv{B_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{:}  \ottmv{B_{\ottmv{m}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_openSession}}{}%
}}


\newcommand{\ottdruleStmtXXset}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{P} \, \in \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x_{\ottmv{n}}}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau_{\ottmv{n}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{B} \, \in \, \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}}%
\ottpremise{\ottsym{[}  \tau_{{\mathrm{1}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}}  \ottsym{]}  \ottsym{==}  \ottnt{argsig}}%
\ottpremise{\ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{B}  \ottsym{)} \, \in \, \ottkw{dom} \, \ottmv{R}}%
\ottpremise{\ottmv{R}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{B}  \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{L'}  \ottsym{=}  \ottmv{L}  \ottsym{[}  \ottsym{(}  \ottmv{A}  \ottsym{,}   \mathcal{C}   \ottsym{)}  \longrightarrow  \ottnt{portlist}  \ottsym{]}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{set} \, \ottmv{A} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{n}}}  \ottsym{)::}  \ottmv{B}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_set}}{}%
}}


\newcommand{\ottdruleStmtXXwrap}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{wrap} \ \{  \mathcal{W}_{stmt} ^+ \}   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_wrap}}{}%
}}


\newcommand{\ottdruleStmtXXconnectTo}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottnt{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}'  \ottsym{:}  \ottnt{Port}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{to} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_connectTo}}{}%
}}


\newcommand{\ottdruleStmtXXconnectAnd}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottnt{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}'  \ottsym{:}  \ottnt{Port}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{and} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C} }{%
{\ottdrulename{Stmt\_connectAnd}}{}%
}}

\newcommand{\ottdefnStmt}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{stmt}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdruleStmtXXdecl{}}
\ottusedrule{\ottdruleStmtXXseq{}}
\ottusedrule{\ottdruleStmtXXpvt{}}
\ottusedrule{\ottdruleStmtXXsendPortToVar{}}
\ottusedrule{\ottdruleStmtXXsendVarToPort{}}
\ottusedrule{\ottdruleStmtXXsendExprToExpr{}}
\ottusedrule{\ottdruleStmtXXassignmnt{}}
\ottusedrule{\ottdruleStmtXXopenSession{}}
\ottusedrule{\ottdruleStmtXXset{}}
\ottusedrule{\ottdruleStmtXXwrap{}}
\ottusedrule{\ottdruleStmtXXconnectTo{}}
\ottusedrule{\ottdruleStmtXXconnectAnd{}}
\end{ottdefnblock}}

%% defn Wrapstmt
\newcommand{\ottdruleWrapstmtXXbefore}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottnt{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{before} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}{%
{\ottdrulename{Wrapstmt\_before}}{}%
}}


\newcommand{\ottdruleWrapstmtXXafter}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottnt{Port}}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}}%
\ottpremise{\ottmv{G'}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S'}  \ottsym{,}  \ottmv{L'}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottkw{after} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S''}  \ottsym{,}  \ottmv{L''}}{%
{\ottdrulename{Wrapstmt\_after}}{}%
}}

\newcommand{\ottdefnWrapstmt}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdruleWrapstmtXXbefore{}}
\ottusedrule{\ottdruleWrapstmtXXafter{}}
\end{ottdefnblock}}

%% defn Protocol
\newcommand{\ottdrulePrtclXXdecl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{P} \, \notin \, \ottkw{dom} \, \ottmv{M}}%
\ottpremise{\ottmv{G'}  \ottsym{=}  \ottmv{G}  \ottsym{[}  \ottmv{P}  \longrightarrow  \ottsym{(}  \ottkw{Protocol}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G''}  \ottsym{=}  \ottmv{G'}  \ottsym{[}  \ottmv{x_{{\mathrm{1}}}}  \longrightarrow  \ottsym{(}  \tau_{{\mathrm{1}}}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G'''}  \ottsym{=}  \ottmv{G''}  \ottsym{[}  \ottmv{A}  \longrightarrow  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{G}   \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottnt{portlist}  \ottsym{=}  \ottsym{\{}  \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}}%
\ottpremise{\ottmv{R'}  \ottsym{=}  \ottmv{R}  \ottsym{[}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{)}  \longrightarrow  \ottnt{portlist}  \ottsym{]}}%
\ottpremise{\ottmv{M'}  \ottsym{=}  \ottmv{M}  \ottsym{[}  \ottmv{P}  \longrightarrow  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}  \ottsym{]}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M'}  \ottsym{,}  \ottmv{R'}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \vdash  \ottnt{prtcl'}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G'''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}}%
\ottpremise{\ottmv{G'''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{stmt}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{G''''}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R'''}  \ottsym{,}  \ottmv{S'''}  \ottsym{,}  \ottmv{L'''}}%
}{
\ottmv{M}  \ottsym{,}  \ottmv{R}  \vdash  \ottkw{protocol} \, \ottmv{P}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{(}  \ottnt{prtcl'}  \ottsym{)}  \ottsym{)}  \ottsym{:} \, \ottkw{party} \, \ottmv{A} \, \ottkw{each} \, \ottkw{with} \, \ottsym{\{}  \ottnt{Port} \, \ottmv{x'_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port} \, \ottmv{x'_{\ottmv{i}}}  \ottsym{\}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}  \ottsym{:}  \ottsym{()}  \ottsym{,}  \ottmv{M''}  \ottsym{,}  \ottmv{R''}}{%
{\ottdrulename{Prtcl\_decl}}{}%
}}

\newcommand{\ottdefnProtocol}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{prtcl}  \ottsym{:}  \tau  \ottsym{,}  \mathcal{E}'$}{}
\ottusedrule{\ottdrulePrtclXXdecl{}}
\end{ottdefnblock}}

%% defn Exp
\newcommand{\ottdruleExpXXAddition}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{:}  \tau}%
\ottpremise{\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp'}  \ottsym{:}  \tau}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottnt{exp}  \ottsym{+}  \ottnt{exp'}  \ottsym{:}  \tau}{%
{\ottdrulename{Exp\_Addition}}{}%
}}


\newcommand{\ottdruleExpXXPartyVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Int}  \ottsym{,}  \ottmv{A}  \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{A}  \ottsym{.}  \ottmv{x}  \ottsym{:}  \ottkw{Int}}{%
{\ottdrulename{Exp\_PartyVar}}{}%
}}


\newcommand{\ottdruleExpXXStatement}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \tau  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \vdash  \ottmv{x}  \ottsym{:}  \tau}{%
{\ottdrulename{Exp\_Statement}}{}%
}}

\newcommand{\ottdefnExp}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \ottnt{exp}  \ottsym{:}  \tau$}{}
\ottusedrule{\ottdruleExpXXAddition{}}
\ottusedrule{\ottdruleExpXXPartyVar{}}
\ottusedrule{\ottdruleExpXXStatement{}}
\end{ottdefnblock}}

%% defn Pexp
\newcommand{\ottdrulePexpXXExpToEnv}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Session}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{S}  \ottsym{(}  \ottmv{s}  \ottsym{)}  \ottsym{=}  \ottmv{P}}%
\ottpremise{\ottmv{M}  \ottsym{(}  \ottmv{P}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottnt{argsig}  \ottsym{,}  \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}  \ottsym{)}}%
\ottpremise{\ottmv{A} \, \in \, \ottsym{\{}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\}}}%
\ottpremise{\ottmv{R}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{r} \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{s}  \ottsym{.}  \ottmv{A} \, \Vert \, \ottmv{r}  \ottsym{:}  \ottnt{Port}}{%
{\ottdrulename{Pexp\_ExpToEnv}}{}%
}}


\newcommand{\ottdrulePexpXXPortOfParty}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}   \mathcal{C}   \ottsym{)}}%
\ottpremise{\ottmv{L}  \ottsym{(}  \ottmv{A}  \ottsym{,}   \mathcal{C}   \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{r} \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{A} \, \Vert \, \ottmv{r}  \ottsym{:}  \ottnt{Port}}{%
{\ottdrulename{Pexp\_PortOfParty}}{}%
}}


\newcommand{\ottdrulePexpXXPortOfCurntParty}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{G}  \ottsym{(}   \mathcal{C}   \ottsym{)}  \ottsym{=}  \ottsym{(}  \ottkw{Party}  \ottsym{,}  \ottsym{\_}  \ottsym{)}}%
\ottpremise{\ottmv{L}  \ottsym{(}   \mathcal{C}   \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottnt{portlist}}%
\ottpremise{\ottmv{r} \, \in \, \ottnt{portlist}}%
}{
\ottmv{G}  \ottsym{,}  \ottmv{M}  \ottsym{,}  \ottmv{R}  \ottsym{,}  \ottmv{S}  \ottsym{,}  \ottmv{L}  \ottsym{,}   \mathcal{C}   \vdash  \ottmv{r}  \ottsym{:}  \ottnt{Port}}{%
{\ottdrulename{Pexp\_PortOfCurntParty}}{}%
}}

\newcommand{\ottdefnPexp}[1]{\begin{ottdefnblock}[#1]{$\mathcal{E}  \vdash  \mathcal{P}_{exp}  \ottsym{:}  \tau$}{}
\ottusedrule{\ottdrulePexpXXExpToEnv{}}
\ottusedrule{\ottdrulePexpXXPortOfParty{}}
\ottusedrule{\ottdrulePexpXXPortOfCurntParty{}}

\section{Compilation Semantics}
\label{sec.comp}
The following rules define the compilation sematics of our language. Our language
first gets compiled to the following representation.
\end{ottdefnblock}}


\newcommand{\ottdefnsJtype}{
\ottdefnConstant{}\ottdefnStmt{}\ottdefnWrapstmt{}\ottdefnProtocol{}\ottdefnExp{}\ottdefnPexp{}}

% defns Jop
%% defn stmt_com
\newcommand{\ottdruleComplXXdecl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{create}  \ottsym{(}  \tau \, \ottmv{x}  \ottsym{;}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \tau \, \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_decl}}{}%
}}


\newcommand{\ottdruleComplXXseq}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \vdash  \ottnt{stmt}  \ottsym{;}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle  \vdash  \ottnt{stmt'}  \ottsym{;}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottnt{stmt}  \ottsym{;}  \ottnt{stmt'}  \ottsym{;}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_seq}}{}%
}}


\newcommand{\ottdruleComplXXpvt}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{E}  \ottsym{(}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{E}  \ottsym{(}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottmv{E}  \ottsym{,}  \ottmv{K}  \ottsym{,}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt}  \ottsym{,}  \ottmv{E'}  \ottsym{,}  \ottmv{K'}  \ottsym{,}  \ottmv{P'_{\ottmv{c}}}  \ottsym{,}  \ottmv{O'}}%
\ottpremise{\ottmv{E'}  \ottsym{,}  \ottmv{K'}  \ottsym{,}  \ottmv{P'_{\ottmv{c}}}  \ottsym{,}  \ottmv{O'}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \vdash  \ottnt{stmt}  \ottsym{,}  \ottmv{E''}  \ottsym{,}  \ottmv{K''}  \ottsym{,}  \ottmv{P''_{\ottmv{c}}}  \ottsym{,}  \ottmv{O''}}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{O}  \vdash  \ottkw{in} \, \ottkw{each} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}  \ottsym{:}  \ottmv{E''}  \ottsym{,}  \ottmv{K''}  \ottsym{,}  \ottmv{P''_{\ottmv{c}}}  \ottsym{,}  \ottmv{O''}}{%
{\ottdrulename{Compl\_pvt}}{}%
}}


\newcommand{\ottdruleComplXXsendPortToVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottmv{x}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r}  \ottsym{)}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \Rightarrow  \ottmv{x}  \ottsym{;}  \ottsym{:}  \ottmv{O'}}{%
{\ottdrulename{Compl\_sendPortToVar}}{}%
}}


\newcommand{\ottdruleComplXXsendVarToPort}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottmv{x}  \ottsym{)}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottmv{x}  \Rightarrow  \mathcal{P}_{exp}  \ottsym{;}  \ottsym{:}  \ottmv{O'}}{%
{\ottdrulename{Compl\_sendVarToPort}}{}%
}}


\newcommand{\ottdruleComplXXsendPexpToPexp}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}'  \ottsym{=}  \ottsym{(}  \ottmv{B}  \ottsym{,}  \ottmv{r_{{\mathrm{2}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottmv{B}  \ottsym{.}  \ottmv{r_{{\mathrm{2}}}}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \Rightarrow  \mathcal{P}_{exp}'  \ottsym{;}  \ottsym{:}  \ottmv{O'}}{%
{\ottdrulename{Compl\_sendPexpToPexp}}{}%
}}


\newcommand{\ottdruleComplXXsendExprToExprXXA}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{A}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottkw{send} \, \ottmv{x} \, \ottkw{to} \, \ottmv{B}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{A}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{A}  \vdash  \ottmv{A}  \ottsym{.}  \ottmv{x}  \Rightarrow  \ottmv{B}  \ottsym{.}  \ottmv{y}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{A}  \rangle}{%
{\ottdrulename{Compl\_sendExprToExpr\_A}}{}%
}}


\newcommand{\ottdruleComplXXsendExprToExprXXB}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottmv{y}  \ottsym{=} \, \ottkw{read} \, \ottsym{(}  \ottmv{A}  \ottsym{)}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{B}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{B}  \vdash  \ottmv{A}  \ottsym{.}  \ottmv{x}  \Rightarrow  \ottmv{B}  \ottsym{.}  \ottmv{y}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{B}  \rangle}{%
{\ottdrulename{Compl\_sendExprToExpr\_B}}{}%
}}


\newcommand{\ottdruleComplXXassignment}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottmv{x}  \ottsym{=}  \ottnt{exp}  \ottsym{;}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_assignment}}{}%
}}


\newcommand{\ottdruleComplXXopenSession}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{E}  \ottsym{(}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{B}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottmv{O}  \langle  \ottmv{B}  \rangle}%
\ottpremise{\ottmv{E}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottmv{O}  \langle  \ottmv{A}  \rangle}%
\ottpremise{\ottmv{E'}  \ottsym{=}  \ottmv{E}  \ottsym{[}  \ottsym{(}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{,}  \ottmv{B}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle  \ottsym{]}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{A}  \rangle \, \xLongrightarrow{copycode} \, \ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle}%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \, \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}   \varepsilon   \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{B}  \rangle}%
\ottpremise{\ottmv{P_{\ottmv{c}}} \, \underrightarrow{create} \, \ottsym{(}   \rightfilledspoon  \, \ottmv{w}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}   \varepsilon  \, \rightleftharpoons \, \ottmv{w}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle  \underrightarrow{attach}  \ottsym{(}   \varepsilon  \, \rightleftharpoons \, \ottmv{w}  \ottsym{)}}%
\ottpremise{\ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{A}  \rangle  \ottsym{)}  \ottsym{=}  \ottsym{\{}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{r_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{n}}} \, \ottmv{r_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle}%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{n}}} \, \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{B}  \rangle}%
\ottpremise{\ottmv{P_{\ottmv{c}}} \, \underrightarrow{create} \, \ottsym{(}   \rightfilledspoon  \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}   \rightfilledspoon  \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{r_{\ottmv{n}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{K'}  \ottsym{=}  \ottmv{K}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{s}  \ottsym{.}  \ottmv{A}  \rangle  \longrightarrow  \ottsym{\{}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K''}  \ottsym{=}  \ottmv{K'}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{B}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{B}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}   \varepsilon  \, \ottnt{Port}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K'''}  \ottsym{=}  \ottmv{K''}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{B}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{B}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{K}  \ottsym{,}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottkw{open} \, \ottmv{s} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{i}}}  \ottsym{)}  \ottsym{\{}  \ottmv{A}  \ottsym{:}  \ottmv{B}  \ottsym{\}}  \ottsym{:}  \ottmv{E'}  \ottsym{,}  \ottmv{K'''}  \ottsym{,}  \ottmv{P'_{\ottmv{c}}}  \ottsym{,}  \ottmv{O'}}{%
{\ottdrulename{Compl\_openSession}}{}%
}}


\newcommand{\ottdruleComplXXset}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{E}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{B}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \ottsym{=}  \ottmv{O}  \langle  \ottmv{B}  \rangle}%
\ottpremise{\ottmv{E'}  \ottsym{=}  \ottmv{E}  \ottsym{[}  \ottsym{(}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{A}  \ottsym{,}  \ottmv{D}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle  \ottsym{]}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{B}  \rangle \, \xLongrightarrow{copycode} \, \ottmv{O}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{B}  \rangle  \ottsym{)}  \ottsym{=}  \ottsym{\{}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{r_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{n}}} \, \ottmv{r_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{n}}} \, \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{P_{\ottmv{c}}} \, \underrightarrow{create} \, \ottsym{(}   \rightfilledspoon  \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}   \rightfilledspoon  \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{r_{\ottmv{n}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{n}}}  \ottsym{)}}%
\ottpremise{\ottmv{K'}  \ottsym{=}  \ottmv{K}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle  \longrightarrow  \ottsym{\{}  \ottsym{(}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K''}  \ottsym{=}  \ottmv{K}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{D}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{D}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{\ottmv{n}}} \, \ottnt{Port_{\ottmv{n}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{K}  \ottsym{,}  \ottmv{P_{\ottmv{c}}}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottkw{set} \, \ottmv{A} \, \ottkw{as} \, \ottmv{P}  \ottsym{(}  \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottmv{x_{\ottmv{i}}}  \ottsym{)::}  \ottmv{B}  \ottsym{:}  \ottmv{K''}  \ottsym{,}  \ottmv{P'_{\ottmv{c}}}  \ottsym{,}  \ottmv{E'}  \ottsym{,}  \ottmv{O'}  \langle  \ottmv{A}  \ottsym{.}  \ottmv{D}  \rangle  \ottsym{,}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_set}}{}%
}}


\newcommand{\ottdruleComplXXwrap}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{append}  \ottsym{(}  \ottkw{while} \, \ottsym{(}  \ottkw{true}  \ottsym{)}  \ottsym{\{}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{\}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{E}  \ottsym{,}  \ottmv{K}  \ottsym{,}  \ottmv{O'}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \ottmv{O''}}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash   \textbf{wrap} \ \{  \mathcal{W}_{stmt} ^+ \}   \ottsym{:}  \ottmv{O''}}{%
{\ottdrulename{Compl\_wrap}}{}%
}}


\newcommand{\ottdruleComplXXconnectXXTo}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{create}  \ottsym{(}   \rightfilledspoon  \, \ottmv{w}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{O'}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}'  \ottsym{=}  \ottsym{(}  \ottmv{B}  \ottsym{,}  \ottmv{r_{{\mathrm{2}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \rightharpoonccw \, \ottmv{w}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{B}  \ottsym{.}  \ottmv{r_{{\mathrm{2}}}} \, \leftharpoonccw \, \ottmv{w}  \ottsym{)}}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{to} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_connect\_To}}{}%
}}


\newcommand{\ottdruleComplXXconnectXXAnd}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle  \underrightarrow{create}  \ottsym{(}   \rightfilledspoon  \, \ottmv{w}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{O'}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r_{{\mathrm{1}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}'  \ottsym{=}  \ottsym{(}  \ottmv{B}  \ottsym{,}  \ottmv{r_{{\mathrm{2}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w}  \ottsym{)}}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{B}  \ottsym{.}  \ottmv{r_{{\mathrm{2}}}} \, \rightleftharpoons \, \ottmv{w}  \ottsym{)}}%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash   \textbf{connect} \  \mathcal{P}_{exp}  \ \textbf{and} \  \mathcal{P}_{exp}'   \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}{%
{\ottdrulename{Compl\_connect\_And}}{}%
}}

\newcommand{\ottdefnstmtXXcom}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \ottnt{stmt}  \ottsym{:}  \mathcal{M}'$}{\ottcom{Compiling Statements}}
\ottusedrule{\ottdruleComplXXdecl{}}
\ottusedrule{\ottdruleComplXXseq{}}
\ottusedrule{\ottdruleComplXXpvt{}}
\ottusedrule{\ottdruleComplXXsendPortToVar{}}
\ottusedrule{\ottdruleComplXXsendVarToPort{}}
\ottusedrule{\ottdruleComplXXsendPexpToPexp{}}
\ottusedrule{\ottdruleComplXXsendExprToExprXXA{}}
\ottusedrule{\ottdruleComplXXsendExprToExprXXB{}}
\ottusedrule{\ottdruleComplXXassignment{}}
\ottusedrule{\ottdruleComplXXopenSession{}}
\ottusedrule{\ottdruleComplXXset{}}
\ottusedrule{\ottdruleComplXXwrap{}}
\ottusedrule{\ottdruleComplXXconnectXXTo{}}
\ottusedrule{\ottdruleComplXXconnectXXAnd{}}
\end{ottdefnblock}}

%% defn wstmt_com
\newcommand{\ottdruleComplXXbefore}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r}  \ottsym{)}}%
\ottpremise{\ottmv{E'}  \ottsym{=}  \ottmv{E}  \ottsym{[}  \ottsym{(}  \ottsym{\_}  \ottsym{,}  \ottsym{\_}  \ottsym{,}  \ottmv{Z}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{Z}  \rangle  \ottsym{]}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{D}  \rangle \, \underrightarrow{replace} \, \ottsym{(}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{,}  \ottkw{if} \, \ottsym{(}  \ottmv{A}  \ottsym{.}  \ottmv{r}  \ottsym{.} \, \ottkw{ITR}  \ottsym{)}  \ottsym{\{}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{\}}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{D}  \rangle}%
\ottpremise{\ottmv{O'}  \ottsym{,}  \ottmv{Z}  \vdash  \ottnt{stmt_{{\mathrm{1}}}}  \ottsym{:}  \ottmv{O''}}%
\ottpremise{\ottmv{O''}  \ottsym{,}  \ottmv{Z}  \vdash  \ottnt{stmt_{\ottmv{n}}}  \ottsym{:}  \ottmv{O'''}}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{D}  \rangle \, \underrightarrow{replace} \, \ottsym{(}  \ottsym{/*} \, \ottkw{str} \, \ottsym{*/}  \ottsym{,}  \ottmv{O'''}  \langle  \ottmv{Z}  \rangle  \ottsym{)}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{D}  \rangle}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottkw{before} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottmv{E}  \ottsym{,}  \ottmv{O'}}{%
{\ottdrulename{Compl\_before}}{}%
}}


\newcommand{\ottdruleComplXXafter}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \mathcal{P}_{exp}  \ottsym{=}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{r}  \ottsym{)}}%
\ottpremise{\ottmv{E'}  \ottsym{=}  \ottmv{E}  \ottsym{[}  \ottsym{(}  \ottsym{\_}  \ottsym{,}  \ottsym{\_}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{A}  \rangle  \ottsym{]}}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottkw{after} \, \mathcal{P}_{exp} \, \ottkw{do} \, \ottsym{\{}  \ottnt{statement_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{statement_{\ottmv{n}}}  \ottsym{\}}  \ottsym{:}  \ottmv{O}  \langle  \ottmv{Z}  \rangle}{%
{\ottdrulename{Compl\_after}}{}%
}}

\newcommand{\ottdefnwstmtXXcom}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \mathcal{W}_{stmt}  \ottsym{:}  \mathcal{M}'$}{\ottcom{Compiling statements inside wrap}}
\ottusedrule{\ottdruleComplXXbefore{}}
\ottusedrule{\ottdruleComplXXafter{}}
\end{ottdefnblock}}

%% defn prtcl_com
\newcommand{\ottdruleComplXXprtcl}[1]{\ottdrule[#1]{%
\ottpremise{\ottmv{E'}  \ottsym{=}  \ottmv{E}  \ottsym{[}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \ottsym{]}}%
\ottpremise{\ottmv{E''}  \ottsym{=}  \ottmv{E'}  \ottsym{[}  \ottsym{(}  \ottmv{P}  \ottsym{,}  \ottmv{A_{\ottmv{m}}}  \ottsym{,}  \ottsym{\_}  \ottsym{)}  \longrightarrow  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \ottsym{]}}%
\ottpremise{\ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{;}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{y_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{i}}} \, \ottmv{y_{\ottmv{i}}}  \ottsym{)}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{O''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \, \ottmv{A_{{\mathrm{2}}}}  \ottsym{)}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{O''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \, \ottmv{A_{\ottmv{m}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{O'''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \,  \varepsilon   \ottsym{)}  \ottsym{:}  \ottmv{O''''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle}%
\ottpremise{\ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{;}  \ottsym{)}  \ottsym{:}  \ottmv{O'}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottmv{O'}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{y_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{i}}} \, \ottmv{y_{\ottmv{i}}}  \ottsym{)}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottmv{O''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \, \ottmv{A_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{:}  \ottmv{O''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottmv{O''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \, \ottmv{A_{{\ottmv{m}-1}}}  \ottsym{)}  \ottsym{:}  \ottmv{O'''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottmv{O'''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{create}  \ottsym{(}  \ottnt{Port} \,  \varepsilon   \ottsym{)}  \ottsym{:}  \ottmv{O''''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle}%
\ottpremise{\ottsym{m'}  \ottsym{=}  \ottmv{m}  \ottsym{-}  \ottsym{1}}%
\ottpremise{\ottmv{j}  \ottsym{=}  \ottsym{(}  \ottmv{m}  \ottsym{*}  \ottsym{m'}  \ottsym{)}  \ottsym{/}  \ottsym{2}}%
\ottpremise{\ottmv{P} \, \underrightarrow{create} \, \ottsym{(}   \rightfilledspoon  \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}   \rightfilledspoon  \, \ottmv{w_{\ottmv{j}}}  \ottsym{)}}%
\ottpremise{\ottmv{O''''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A_{{\mathrm{2}}}} \, \rightleftharpoons \, \ottmv{w_{{\mathrm{1}}}}  \ottsym{)}}%
\ottpremise{\ottmv{O''''}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A_{\ottmv{m}}} \, \rightleftharpoons \, \ottmv{w_{{\ottmv{m}-1}}}  \ottsym{)}}%
\ottpremise{\ottmv{O''''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A_{{\mathrm{1}}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{i}}}  \ottsym{)}}%
\ottpremise{\ottmv{O''''}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \underrightarrow{attach}  \ottsym{(}  \ottmv{A_{{\ottmv{m}-1}}} \, \rightleftharpoons \, \ottmv{w_{\ottmv{j}}}  \ottsym{)}}%
\ottpremise{\ottmv{K'}  \ottsym{=}  \ottmv{K}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \longrightarrow  \ottsym{\{}  \ottsym{(}  \ottmv{y_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{y_{\ottmv{i}}} \, \ottnt{Port_{\ottmv{i}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K''}  \ottsym{=}  \ottmv{K'}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}  \ottmv{A_{{\mathrm{2}}}} \, \ottnt{Port}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{A_{\ottmv{m}}} \, \ottnt{Port}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K'''}  \ottsym{=}  \ottmv{K''}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{A_{{\mathrm{1}}}}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}   \varepsilon  \, \ottnt{Port}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K''''}  \ottsym{=}  \ottmv{K'''}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \longrightarrow  \ottsym{\{}  \ottsym{(}  \ottmv{y_{{\mathrm{1}}}} \, \ottnt{Port_{{\mathrm{1}}}}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{y_{\ottmv{i}}} \, \ottnt{Port_{\ottmv{i}}}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K'''''}  \ottsym{=}  \ottmv{K''''}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}  \ottmv{A_{{\mathrm{1}}}} \, \ottnt{Port}  \ottsym{)}  \ottsym{,} \, .. \, \ottsym{,}  \ottsym{(}  \ottmv{A_{{\ottmv{m}-1}}} \, \ottnt{Port}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{K''''''}  \ottsym{=}  \ottmv{K'''''}  \ottsym{[}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \longrightarrow  \ottmv{K}  \ottsym{(}  \ottmv{O}  \langle  \ottmv{A_{\ottmv{m}}}  \rangle  \ottsym{)} \, \cup \, \ottsym{\{}  \ottsym{(}   \varepsilon  \, \ottnt{Port}  \ottsym{)}  \ottsym{\}}  \ottsym{]}}%
\ottpremise{\ottmv{E''}  \ottsym{,}  \ottmv{K''''''}  \ottsym{,}  \ottmv{P}  \ottsym{,}  \ottmv{O''''}  \ottsym{,}  \ottmv{A_{{\mathrm{1}}}}  \vdash  \ottnt{stmt}  \ottsym{:}  \ottmv{E'''}  \ottsym{,}  \ottmv{K'''''''}  \ottsym{,}  \ottmv{P'}  \ottsym{,}  \ottmv{O'''''}}%
}{
\ottmv{E}  \ottsym{,}  \ottmv{K}  \ottsym{,}  \ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottkw{protocol} \, \ottmv{P}  \ottsym{(}  \tau_{{\mathrm{1}}} \, \ottmv{x_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \tau_{\ottmv{n}} \, \ottmv{x_{\ottmv{n}}}  \ottsym{(}  \ottnt{prtcl'}  \ottsym{)}  \ottsym{)}  \ottsym{:} \, \ottkw{party} \, \ottmv{A} \, \ottkw{each} \, \ottkw{with} \, \ottsym{\{}  \ottnt{Port_{{\mathrm{1}}}} \, \ottmv{y_{{\mathrm{1}}}}  \ottsym{,} \, .. \, \ottsym{,}  \ottnt{Port_{\ottmv{i}}} \, \ottmv{y_{\ottmv{i}}}  \ottsym{\}}  \ottsym{\{}  \ottnt{stmt}  \ottsym{\}}  \ottsym{:}  \ottmv{E'}  \ottsym{,}  \ottmv{K'''''''}  \ottsym{,}  \ottmv{O'''''}}{%
{\ottdrulename{Compl\_prtcl}}{}%
}}

\newcommand{\ottdefnprtclXXcom}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \ottnt{prtcl}  \ottsym{:}  \mathcal{M}'$}{\ottcom{Compiling Protocol}}
\ottusedrule{\ottdruleComplXXprtcl{}}
\end{ottdefnblock}}

%% defn exp_com
\newcommand{\ottdruleComplXXExpXXStatement}[1]{\ottdrule[#1]{%
}{
 \phi   \vdash  \ottmv{x}  \ottsym{:}  \ottkw{read} \, \ottsym{(}  \ottmv{x}  \ottsym{)}}{%
{\ottdrulename{Compl\_Exp\_Statement}}{}%
}}


\newcommand{\ottdruleComplXXExpXXAddition}[1]{\ottdrule[#1]{%
}{
 \phi   \vdash  \ottnt{exp}  \ottsym{+}  \ottnt{exp'}  \ottsym{:}  \ottkw{read} \, \ottsym{(}  \ottnt{exp}  \ottsym{)}  \ottsym{+} \, \ottkw{read} \, \ottsym{(}  \ottnt{exp'}  \ottsym{)}}{%
{\ottdrulename{Compl\_Exp\_Addition}}{}%
}}

\newcommand{\ottdefnexpXXcom}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \ottnt{exp}  \ottsym{:}  \ottnt{impl\_instr}$}{\ottcom{Compiling expressions}}
\ottusedrule{\ottdruleComplXXExpXXStatement{}}
\ottusedrule{\ottdruleComplXXExpXXAddition{}}
\end{ottdefnblock}}

%% defn pexp_co
\newcommand{\ottdruleComplXXExpToEnv}[1]{\ottdrule[#1]{%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottmv{s}  \ottsym{.}  \ottmv{A} \, \Vert \, \ottmv{r}  \ottsym{:}  \ottsym{(}  \ottmv{s}  \ottsym{.}  \ottmv{A}  \ottsym{,}  \ottmv{r}  \ottsym{)}}{%
{\ottdrulename{Compl\_ExpToEnv}}{}%
}}


\newcommand{\ottdruleComplXXPortOfAnotherParty}[1]{\ottdrule[#1]{%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottmv{A} \, \Vert \, \ottmv{B}  \ottsym{:}  \ottsym{(}  \ottmv{A}  \ottsym{,}  \ottmv{B}  \ottsym{)}}{%
{\ottdrulename{Compl\_PortOfAnotherParty}}{}%
}}


\newcommand{\ottdruleComplXXOnlyPortOfCurntParty}[1]{\ottdrule[#1]{%
}{
\ottmv{O}  \ottsym{,}  \ottmv{D}  \vdash  \ottmv{r}  \ottsym{:}  \ottsym{(}  \ottmv{D}  \ottsym{,}  \ottmv{r}  \ottsym{)}}{%
{\ottdrulename{Compl\_OnlyPortOfCurntParty}}{}%
}}

\newcommand{\ottdefnpexpXXco}[1]{\begin{ottdefnblock}[#1]{$\mathcal{M}  \vdash  \mathcal{P}_{exp}  \ottsym{:}  \ottsym{(}  \ottnt{scope}  \ottsym{,}  \ottnt{portname}  \ottsym{)}$}{\ottcom{Compiling Port Expression}}
\ottusedrule{\ottdruleComplXXExpToEnv{}}
\ottusedrule{\ottdruleComplXXPortOfAnotherParty{}}
\ottusedrule{\ottdruleComplXXOnlyPortOfCurntParty{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsJop}{
\ottdefnstmtXXcom{}\ottdefnwstmtXXcom{}\ottdefnprtclXXcom{}\ottdefnexpXXcom{}\ottdefnpexpXXco{}}

\newcommand{\ottdefnss}{
\ottdefnsJtype
\ottdefnsJop
}

\newcommand{\ottall}{\ottmetavars\\[0pt]
\ottgrammar\\[5.0mm]
\ottdefnss}

